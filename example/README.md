# zkWasm Mini Rollup - RainbowKit Integration Example

This is a complete example application demonstrating how to integrate RainbowKit wallet connection functionality in a zkWasm Mini Rollup project.

## Features

- ðŸŒˆ **RainbowKit Wallet Connection** - Support for multiple wallets (MetaMask, WalletConnect, Coinbase Wallet, etc.)
- ðŸ”— **Dynamic Chain Configuration** - Automatically configure supported blockchain networks based on environment variables
- ðŸ”‘ **L1/L2 Account Management** - Complete Ethereum mainnet and zkWasm Rollup account demonstration
- ðŸ’° **Deposit Functionality** - Complete flow for depositing from L1 to L2
- ðŸ“Š **State Management** - Redux-based application state management
- ðŸŽ¨ **Modern UI** - Responsive design and beautiful user interface

## Quick Start

### 1. Install Dependencies

Run from the project root directory:

```bash
npm install
```

### 2. Configure Environment Variables

Copy the example environment variables file and configure:

```bash
cp example/env.example example/.env
```

Configure the following variables in `example/.env`:

```env
# WalletConnect Project ID (Required)
REACT_APP_WALLETCONNECT_PROJECT_ID=your_project_id_here

# Target Chain ID (Optional, defaults to 1)
REACT_APP_CHAIN_ID=1

# Contract Addresses (Configure according to your deployment)
REACT_APP_DEPOSIT_CONTRACT=0x1234567890123456789012345678901234567890
REACT_APP_TOKEN_CONTRACT=0x0987654321098765432109876543210987654321
```

#### Chain ID Configuration

After setting `REACT_APP_CHAIN_ID`, RainbowKit will only display the corresponding chain:

- `1` - Ethereum Mainnet
- `11155111` - Sepolia Testnet  
- `137` - Polygon
- `42161` - Arbitrum One
- `8453` - Base
- `10` - Optimism
- `56` - BSC (Binance Smart Chain)
- `31337` - Localhost (Development Environment)

**Note:** RainbowKit will only display the network corresponding to the configured chain ID, ensuring users can only connect to the correct chain.

### 3. Get WalletConnect Project ID

1. Visit [WalletConnect Cloud](https://cloud.walletconnect.com/)
2. Create a new project
3. Copy the Project ID to your environment variables

### 4. Start Development Server

```bash
npm run dev:example
```

The application will start at `http://localhost:5173`.

## Feature Demonstration

### 1. Wallet Connection

- Click the "Connect Wallet" button
- Select your preferred wallet (MetaMask, WalletConnect, etc.)
- The app will automatically detect and display wallet information

### 2. L1 Account Login

- After connecting your wallet, click "Login L1 Account"
- The app will automatically switch to the configured target chain
- Display Ethereum mainnet account information and available functions

### 3. L2 Account Login

- Click the "Generate L2 Account" button
- The system will ask you to sign the fixed message "0xAUTOMATA"
- The signature result will be used as a private key to generate a deterministic L2 key pair
- Display L2 public key, PID[1], PID[2] and available functions

**Important:** L2 accounts are generated by signing the fixed message "0xAUTOMATA" to create deterministic key pairs. This means:
- All users sign the same message to generate their unique L2 key pairs
- L2 key pairs are independent of specific wallet addresses but still require wallet signatures
- Each wallet will produce different signatures, thus generating different L2 key pairs
- PID[1] and PID[2] are identifiers converted from public keys, used for L2 transactions

### 4. Deposit Operation

- Ensure both L1 and L2 accounts are connected/generated
- Enter deposit amount (ETH)
- Click "Deposit to L2" button
- Confirm transaction and wait for completion

**Deposit Flow:**
1. L1 account authorizes the contract to use your tokens
2. Call the deposit contract to lock funds on L1
3. L2 system detects the deposit and increases corresponding balance on L2
4. Use L2 public key as receiving address

## Technical Architecture

### Key Generation Mechanism

**L1 Account:**
- Directly use wallet address
- Used for L1 on-chain transactions and contract interactions

**L2 Account:**
- Generate deterministic key pair by signing fixed message "0xAUTOMATA"
- Signature result â†’ Private key â†’ Public key â†’ PID[1], PID[2]
- Uses Alt-BabyJubJub elliptic curve cryptography
- PID used to identify accounts in L2 system

### State Management

Uses Redux Toolkit to manage application state:

```typescript
interface AccountState {
  l1Account?: L1AccountInfo;      // L1 wallet address and chain info
  l2account?: L2AccountInfo;      // L2 key pair (private key + public key)
  status: string;                 // Current operation status
}
```

### Main Components

- **App.tsx** - Main application component containing all feature demonstrations
- **main.tsx** - Application entry point, configures providers
- **wagmi-config.ts** - Dynamic chain configuration
- **rainbow-adapter.ts** - RainbowKit adapter

### Supported Operations

#### L1 Account Functions:
- View Ethereum mainnet balance
- Deposit to L2
- Interact with mainnet contracts

#### L2 Account Functions:
- View L2 Rollup balance
- Fast transactions on L2
- Interact with L2 contracts
- Withdraw funds to L1

## Development Guide

### Custom Chain Configuration

Modify the `chainMap` in `src/wagmi-config.ts` to add new chains:

```typescript
const chainMap: Record<number, Chain> = {
  1: mainnet,
  // Add your custom chain
  123: yourCustomChain,
};
```

### Adding New Features

1. Add new thunk functions in `src/reduxstate.ts`
2. Add corresponding UI components in `example/src/App.tsx`
3. Update state type definitions

### Style Customization

Edit `example/src/App.css` to customize application styles. Currently uses modern card-based design.

## Troubleshooting

### Common Issues

1. **Wallet Connection Fails**
   - Check if WalletConnect Project ID is correctly configured
   - Ensure wallet extension is installed

2. **Network Switching Fails**
   - Check `REACT_APP_CHAIN_ID` configuration
   - Confirm wallet supports target network

3. **Signature Fails**
   - Ensure wallet is unlocked
   - Check network connection

4. **Deposit Fails**
   - Check if contract addresses are valid
   - Ensure sufficient token balance
   - Verify network is correct

5. **L2 Key Generation Fails**
   - Ensure wallet is connected
   - Check if user rejected signature request

### Debug Information

The application provides extensive console logging. Open browser developer tools to view:

- Wallet connection status
- Account login process
- Transaction details
- Error messages

### Environment Variables Reference

```env
# Required - Get from WalletConnect Cloud
REACT_APP_WALLETCONNECT_PROJECT_ID=your_project_id

# Optional - Default is 1 (Ethereum Mainnet)
REACT_APP_CHAIN_ID=1

# Required for deposit functionality
REACT_APP_DEPOSIT_CONTRACT=0x...
REACT_APP_TOKEN_CONTRACT=0x...
```

## API Reference

### useZkWasmWallet Hook

The application uses the `useZkWasmWallet` hook which provides:

```typescript
interface ZkWasmWallet {
  connectAndLoginL1: (dispatch: any) => Promise<void>;
  loginL2: (dispatch: any, appName?: string) => Promise<void>;
  deposit: (dispatch: any, params: DepositParams) => Promise<void>;
  reset: (dispatch: any) => void;
}
```

### Redux Actions

- `loginL1AccountWithRainbowKitAsync` - Connect wallet and login L1 account
- `loginL2AccountWithRainbowKitAsync` - Generate L2 key pair
- `depositWithRainbowKitAsync` - Deposit tokens from L1 to L2
- `resetAccountState` - Reset all account state

## Security Considerations

1. **Private Key Safety**: L2 private keys are generated client-side and never transmitted
2. **Transaction Verification**: All transaction parameters are verified before sending
3. **Network Validation**: Ensure connection to correct network before operations
4. **User Confirmation**: Important operations require user signature confirmation

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

MIT License - see LICENSE file for details. 